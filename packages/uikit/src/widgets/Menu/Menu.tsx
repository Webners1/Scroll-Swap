import { useIsMounted } from "@pancakeswap/hooks";
import throttle from "lodash/throttle";
import React, { useEffect, useMemo, useRef, useState } from "react";
import { styled } from "styled-components";
import { AtomBox } from "../../components/AtomBox";
import { Box } from "../../components/Box";
import MenuItem from "../../components/MenuItem/MenuItem";
import { useMatchBreakpoints } from "../../contexts";
import MobileNav from "./MobileNav";
import { MENU_HEIGHT, TOP_BANNER_HEIGHT, TOP_BANNER_HEIGHT_MOBILE } from "./config";
import { MenuContext } from "./context";
import { CustomHeaderWrapperStyled, StyledSidebar } from "./styled";
import { NavProps } from "./types";

const Wrapper = styled.div`
  position: relative;
  width: 100%;
  display: grid;
  grid-template-rows: auto 1fr;
`;

const StyledNav = styled.nav`
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  height: ${MENU_HEIGHT}px;
  background-color: ${({ theme }) => theme.nav.background};
  border-bottom: 1px solid ${({ theme }) => theme.colors.cardBorder};
  transform: translate3d(0, 0, 0);

  padding-left: 16px;
  padding-right: 16px;
`;

const FixedContainer = styled("div").withConfig({
  shouldForwardProp: (props) => !["showMenu"].includes(props),
})<{ showMenu: boolean; height: number }>`
  position: fixed;
  top: ${({ showMenu, height }) => (showMenu ? 0 : `-${height}px`)};
  left: 0;
  transition: top 0.2s;
  height: ${({ height }) => `${height}px`};
  width: fit-content;
  z-index: 20;
`;

const TopBannerContainer = styled.div<{ height: number }>`
  height: ${({ height }) => `${height}px`};
  min-height: ${({ height }) => `${height}px`};
  max-height: ${({ height }) => `${height}px`};
  width: 100%;
`;

const BodyWrapper = styled(Box)`
  position: relative;
  display: flex;
  max-width: 100vw;
  width: 100%;
  min-height: 100vh;
  padding-top: 100px;
  @media (min-width: 768px) {
    padding-top: initial;
  }
`;

const Inner = styled.div`
  flex-grow: 1;
  transition: margin-top 0.2s, margin-left 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translate3d(0, 0, 0);
  max-width: 100%;
  > div {
    background: #272727;
  }
`;

const MainLinkContainerStyled = styled.ul`
  padding: 50px 0px 0px 30px;
  list-style: none;

  li:has(a:empty) {
    display: none;
  }

  li:has(div:empty) {
    display: none;
  }
`;
const MainLinkStyled = styled.li`
  font-size: 16px;
  padding: 12px 20px 12px 30px;
  position: relative;

  a {
    color: rgba(255, 255, 255, 0.6);
    text-decoration: none !important;
    font-weight: 400;
    padding: 0px;
    height: fit-content;
    :hover {
      text-decoration: none;
    }
  }
  &.active {
    background-color: rgb(39, 39, 39);
    border-top-left-radius: 20px;
    border-bottom-left-radius: 20px;

    i {
      svg path {
        fill: #fff;
      }
    }

    a {
      color: #fff;
    }

    .top-curve {
      position: absolute;
      top: -20px;
      height: 20px;
      right: 0px;
      width: 20px;
      display: block;
      background: rgb(39, 39, 39);

      &::before {
        content: "";
        position: absolute;
        top: 0px;
        right: 0px;
        height: 100%;
        width: 20px;
        background: #4b4b4b;
        border-bottom-right-radius: 20px;
      }
    }
    .bottom-curve {
      position: absolute;
      bottom: -20px;
      height: 20px;
      right: 0px;
      width: 20px;
      display: block;
      background: rgb(39, 39, 39);
      &::before {
        content: "";
        position: absolute;
        top: 0px;
        right: 0px;
        height: 100%;
        width: 20px;
        background: #4b4b4b;
        border-top-right-radius: 20px;
      }
    }
  }
`;

const StyledIcon = styled.i`
  padding: 5px;
  border-radius: 7px;
  background-color: rgba(255, 255, 255, 0.05);
  margin-right: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
`;

const BackDrop = styled.div`
  position: absolute;
  background-color: #000;
  opacity: 0.6;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9998;
  margin: auto;
  display: block;
  @media (min-width: 768px) {
    display: none;
  }
`;

const SwapIcon = ({ color = "rgba(255, 255, 255, 0.6)" }: { color?: string }) => (
  <svg
    viewBox="0 0 20 20"
    style={{ paddingTop: 2 }}
    width="20px"
    height="20px"
    color="text"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fill={color}
      d="M15.6495 0.349997L12.8595 3.14C12.5395 3.46 12.7595 4 13.2095 4H14.9995V10.88C14.9995 11.88 14.3295 12.81 13.3395 12.97C12.0895 13.18 10.9995 12.21 10.9995 11V4.17C10.9995 2.08 9.46954 0.219997 7.38954 0.0199968C6.83404 -0.034733 6.27324 0.0274656 5.74323 0.202588C5.21323 0.377711 4.72577 0.661876 4.31223 1.03679C3.89869 1.41171 3.56824 1.86906 3.34216 2.37942C3.11608 2.88977 2.99937 3.44181 2.99954 4V11H1.20954C0.759542 11 0.539542 11.54 0.859542 11.85L3.64954 14.64C3.84954 14.84 4.15954 14.84 4.35954 14.64L7.14954 11.85C7.21864 11.7795 7.26533 11.6901 7.28373 11.5931C7.30212 11.4962 7.29139 11.3959 7.25289 11.305C7.21439 11.2141 7.14985 11.1366 7.06739 11.0823C6.98493 11.0281 6.88826 10.9994 6.78954 11H4.99954V4.12C4.99954 3.12 5.66954 2.19 6.65954 2.03C7.90954 1.82 8.99954 2.79 8.99954 4V10.83C8.99954 12.92 10.5295 14.78 12.6095 14.98C14.9895 15.21 16.9995 13.34 16.9995 11V4H18.7895C19.2395 4 19.4595 3.46 19.1395 3.15L16.3495 0.359997C16.1595 0.159997 15.8395 0.159997 15.6495 0.349997Z"
    />
  </svg>
);

const LiquidityIcon = ({ color = "rgba(255, 255, 255, 0.6)" }: { color?: string }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
    <g>
      <path
        fill={color}
        d="M9.219-.004H11.027c.215 0 .43.004.641.004h1.879v.031c.015 0 .015 0 .035-.004.113.008.219.125.293.207v.032h.031c.012.023.024.043.035.066a1.038 1.038 0 01.098.46V1.255a.813.813 0 01-.238.594c-.184.172-.41.172-.649.168h-.793c.004.464.012.93.016 1.406l.344.094c.133.043.261.086.39.14l.051.024c.113.043.219.093.324.148.028.016.059.027.09.043.02.012.043.024.067.035v.031c.007 0 .02.004.027.004.062.02.11.055.164.086l.04.024c.108.07.21.144.316.226a.237.237 0 00.078.051v.031l.027.012c.035.02.066.04.098.066l.03.024c.028.023.056.043.079.07v.032a.142.142 0 01.027.011c.047.028.086.067.125.106l.024.023c.058.059.058.059.058.094a.102.102 0 00.032.012c.03.02.03.02.046.066h.032a.67.67 0 01.097.117c.028.04.028.04.028.07H15l.066.083c.008.015.02.03.032.05.027.04.027.04.027.07h.031c.028.036.028.036.055.083.012.015.02.03.031.047a.31.31 0 01.04.105h.03l.11.191c.012.024.027.047.039.07.039.067.07.137.101.208.012.023.024.05.04.074.101.203.101.203.101.27l1.672-.016c.035-.067.07-.133.11-.203a.804.804 0 01.25-.25h.03v-.032c.2-.125.395-.167.626-.164h.605c.293 0 .531.098.742.305l.075.094c.007.008.015.016.019.027.11.137.172.305.172.477v2.172c0 .086 0 .172.004.261v.246c-.004.032 0 .06 0 .09 0 .043 0 .082-.004.125a.108.108 0 01.004.035.763.763 0 01-.113.34 1535.402 1535.402 0 01-.05.102h-.033c-.007.02-.007.02-.011.039-.012.02-.012.02-.02.039-.015.004-.031.012-.047.016v.03h-.03c-.005.017-.013.032-.017.048h-.03v.031c-.036.027-.071.055-.11.078l-.031.02c-.11.07-.235.093-.36.12-.008.005-.02.005-.031.009a.558.558 0 01-.113.011H18.387c-.16 0-.317-.027-.461-.093-.016-.008-.031-.012-.047-.02-.012-.004-.024-.012-.035-.016v-.03c-.008 0-.016-.005-.024-.005a.445.445 0 01-.133-.074v-.031l-.027-.012a.39.39 0 01-.098-.082v-.031h-.03c-.036-.04-.048-.055-.048-.11h-.03c-.028-.05-.052-.101-.079-.156h-.645c-.101 0-.203-.004-.3-.004h-.68c-.035 0-.035 0-.063.035l-.023.07c-.066.184-.164.352-.262.52l-.07.133c-.094.18-.227.344-.355.5-.028.031-.028.031-.055.074h-.031c-.004.008-.008.016-.012.028-.102.183-.336.398-.504.52h-.031v.03a1.141 1.141 0 01-.082.063c-.008.008-.016.012-.024.02l-.082.058c-.008.008-.02.012-.027.02-.168.12-.168.12-.207.12v.032c-.024.012-.024.012-.047.027-.04.024-.078.043-.113.07-.043.028-.043.028-.09.028v.031l-.047.024-.031.015c-.024.012-.043.024-.067.035l-.164.082a2.63 2.63 0 01-.285.125.612.612 0 00-.117.047c-.09.031-.176.063-.266.086l-.047.016c-.082.023-.16.047-.242.062-.043.012-.086.02-.125.032-.113.027-.23.039-.344.054-.019.004-.039.004-.062.008-.371.047-.797.063-1.164-.016-.043-.007-.082-.011-.121-.015a.96.96 0 01-.235-.047l-.195-.047a3.218 3.218 0 01-.629-.21 2.486 2.486 0 01-.313-.14c-.015-.01-.03-.017-.046-.025a5.015 5.015 0 01-.613-.383 1.245 1.245 0 00-.09-.062v-.031l-.035-.012c-.055-.024-.09-.059-.133-.098-.051-.055-.051-.055-.114-.094v-.03h-.03v-.032c-.009-.004-.016-.008-.028-.012a.48.48 0 01-.11-.09l-.039-.039c-.027-.031-.027-.031-.027-.062h-.031v-.031c-.016-.004-.031-.012-.047-.016v-.031h-.031c-.078-.086-.078-.086-.078-.125h-.032c-.023-.028-.023-.028-.046-.063-.012-.008-.02-.02-.028-.031-.02-.031-.02-.031-.02-.063h-.03a1.83 1.83 0 01-.079-.105l-.023-.031c-.055-.078-.055-.078-.055-.13h-.031c-.024-.03-.024-.03-.047-.073-.008-.016-.02-.032-.027-.047-.012-.016-.02-.032-.028-.047l-.03-.051c-.071-.117-.071-.117-.071-.172h-.032c-.167-.324-.167-.324-.203-.5h-2.28c-.005.531-.013 1.063-.016 1.61.05.003.101.011.156.015a.755.755 0 01.234.11v.03l.027.012c.04.024.063.047.094.082.008.008.02.02.028.032.023.031.023.031.023.078h.031c.086.203.09.394.086.613v.324a.808.808 0 01-.226.563c-.055.047-.055.047-.094.047v.031l-.074.035-.043.024c-.137.05-.274.054-.414.054h-.051c-.055 0-.11 0-.164-.004h-.38v.032h.032l.043.046c.07.083.145.157.223.235.011.008.02.02.031.027.012.016.012.016.027.028.02.023.02.023.02.054.016.004.031.012.047.016a.769.769 0 01.047.058c.035.055.078.098.125.145.187.203.187.203.187.25h.031c.028.031.055.066.082.098.004.011.012.02.02.03.055.071.055.071.055.106h.03l.044.055.023.035c.008.012.02.024.028.035.02.028.035.055.054.079.008.015.02.027.028.039.023.035.05.07.074.105l.023.027c.012.02.028.04.04.059.046.062.046.062.046.113h.032c.019.028.019.028.042.067.008.011.016.023.024.039a.263.263 0 00.027.043l.024.043.047.082c.015.023.027.047.043.07.043.074.043.074.043.125h.03c.009.016.012.031.02.043.02.05.043.098.067.14.035.075.07.149.101.223l.024.051c.03.07.05.14.07.211.012.043.027.082.04.121.081.242.105.48.105.73v.036c0 .226-.02.437-.082.656-.016.047-.024.094-.036.144a2.355 2.355 0 01-.351.758c-.024.028-.024.028-.035.075h-.032a.139.139 0 01-.015.035c-.016.043-.016.043-.032.074h-.03l-.012.035a.415.415 0 01-.082.121H5.28l-.011.027a.539.539 0 01-.067.098h-.031v.031c-.02.024-.02.024-.047.047h-.031v.032c-.086.078-.086.078-.125.078-.004.015-.012.03-.016.047h-.031v.03c-.024.02-.024.02-.059.044-.011.008-.023.02-.039.027-.011.008-.027.016-.039.027a.263.263 0 00-.043.028c-.027.02-.054.035-.082.054a2.621 2.621 0 01-.723.352c-.019.008-.039.012-.058.02-.047.015-.098.027-.145.043-.015.003-.015.003-.035.011a.984.984 0 01-.215.031c-.03.004-.03.004-.062.02-.027 0-.055 0-.082.004H3.055c-.063-.004-.125 0-.188 0H2.645C2.629 20 2.613 20 2.598 20c-.035 0-.035 0-.051-.016-.024-.004-.043-.004-.067-.007a1.606 1.606 0 01-.382-.09l-.078-.024a2.4 2.4 0 01-.528-.246c-.039-.023-.039-.023-.086-.039v-.031l-.031-.012a.744.744 0 01-.152-.09c-.012-.008-.02-.011-.028-.02-.023-.015-.047-.034-.07-.05v-.031l-.031-.012a.502.502 0 01-.157-.113v-.032l-.027-.011a.39.39 0 01-.098-.082v-.032h-.03c-.032-.03-.032-.03-.063-.078-.012-.011-.024-.027-.035-.039-.028-.039-.028-.039-.028-.07H.625c-.031-.035-.059-.074-.086-.113a.215.215 0 01-.027-.035c-.008-.008-.016-.02-.024-.032a.119.119 0 00-.02-.027c-.015-.027-.015-.027-.015-.074H.422c-.024-.043-.043-.09-.067-.133-.015-.035-.035-.07-.054-.106a2.873 2.873 0 01-.223-.558l-.012-.047a1.257 1.257 0 01-.046-.27c0-.027 0-.027-.02-.043 0-.027-.004-.05-.004-.074v-.05-.055-.055-.113c.004-.059 0-.117 0-.176v-.11-.054-.05-.044c.004-.031.004-.031.02-.047l.007-.062c.012-.117.047-.23.09-.34.016-.047.028-.09.043-.137a.57.57 0 01.063-.16.747.747 0 00.062-.125c.028-.07.059-.137.09-.203.02-.035.035-.074.05-.113h.032c.004-.016.004-.016.004-.035a.305.305 0 01.055-.114c.035-.047.066-.097.097-.148.032-.055.063-.11.098-.16l.07-.117c.02-.024.02-.024.035-.051h.032l.011-.035a.605.605 0 01.083-.137h.03a.27.27 0 01.016-.04c.016-.038.016-.038.032-.07h.03l.013-.035a.532.532 0 01.082-.125l.035-.043a.196.196 0 01.027-.03h.031l.012-.036a.415.415 0 01.082-.121h.031c.008-.012.008-.012.012-.027a.539.539 0 01.067-.098h.03c.005-.008.009-.016.012-.027.028-.047.063-.082.098-.125.055-.051.055-.051.094-.114h.031c.004-.015.012-.031.016-.047h.031v-.03h.031l.012-.028c.023-.04.047-.063.078-.094.008-.012.02-.023.031-.035l.036-.035c.023-.02.046-.043.07-.067.015-.015.015-.015.031-.027.023-.027.023-.027.04-.059h-.325c-.035 0-.074.004-.11.004H1.439c-.145 0-.297-.008-.422-.082-.024-.011-.024-.011-.043-.023-.028-.02-.055-.035-.082-.055v-.031c-.016-.008-.016-.008-.028-.012-.113-.062-.172-.215-.207-.332-.011-.078-.011-.156-.011-.234v-.063c0-.047.003-.094.003-.136v-.176-.133-.066c0-.125.004-.211.07-.317.009-.02.012-.043.016-.062h.032l.011-.036a.38.38 0 01.114-.136h.03v-.031a.703.703 0 01.391-.126v-.046c0-.391 0-.782-.003-1.172v-.567-.492-.262-.246-.09c-.004-.41.078-.785.285-1.14l.023-.04c.016-.03.035-.058.055-.085h.031l.016-.04c.015-.038.015-.038.031-.07h.031c.004-.015.012-.03.016-.046h.031l.012-.028a.52.52 0 01.082-.101l.035-.035c.027-.024.027-.024.059-.024.004-.016.011-.031.015-.047h.031V6.75c.07-.047.07-.047.11-.047v-.031c.414-.297.887-.367 1.383-.367h.699c.187 0 .375-.004.562-.004H5.566c.47 0 .934-.004 1.403-.004l.011-.035c.008-.016.012-.032.02-.047a1.115 1.115 0 01.094-.219c.011-.02.023-.039.031-.062a2.205 2.205 0 00.094-.2h.031c.004-.027.012-.05.016-.078h.03c0-.008.005-.02.005-.027.011-.035.027-.063.047-.098a.158.158 0 00.02-.035l.023-.035.023-.04c.129-.206.129-.206.195-.28h.032l.011-.036a.415.415 0 01.082-.12h.032l.011-.028a.774.774 0 01.102-.129c.047-.047.09-.094.129-.144a.805.805 0 01.101-.098c.008-.008.02-.02.032-.027.007-.008.02-.02.03-.028.013-.008.02-.02.032-.027.008-.008.02-.02.031-.027l.024-.024c.023-.016.023-.016.055-.016v-.03c.03-.028.066-.055.101-.083.008-.004.016-.011.027-.02.07-.054.07-.054.106-.054v-.031l.066-.047c.016-.008.032-.016.047-.027.012-.004.02-.012.027-.016.036-.024.067-.043.102-.063.149-.097.3-.187.461-.27l.047-.023c.101-.054.203-.093.312-.132.07-.024.137-.051.207-.082.043-.02.09-.032.137-.043l.078-.024a.999.999 0 01.188-.039c.027-.012.05-.02.078-.031v-1.39l-.664-.009h-.16c-.239-.003-.45-.027-.63-.203-.155-.168-.195-.336-.195-.566V1.19v-.125c.004-.054 0-.109 0-.164V.746.688a.71.71 0 01.22-.528.53.53 0 01.35-.164zm.125.692v.625h3.969V.688c-.024-.024-.047-.02-.079-.02H9.387c-.028 0-.028 0-.043.02zm1.687 1.328v1.296h.61c.027-.027.02-.062.02-.097V3.18v-.035-.122-.086-.175-.223-.176-.082-.117-.035c0-.063 0-.063-.036-.113h-.594zm-.285 2.039a.333.333 0 01-.09.011c-.113.012-.219.047-.328.075-.02.004-.039.011-.058.015a4.4 4.4 0 00-1.082.48c-.028.016-.055.032-.079.048-.015.007-.015.007-.03.02v.03H9.03v.032c-.008.004-.02.007-.027.011a.782.782 0 00-.094.063l-.031.023-.035.024a.196.196 0 01-.031.027C8.69 5 8.69 5 8.59 5.105c-.04.051-.04.051-.074.067v.031h-.032c-.027.027-.027.027-.054.059-.051.062-.051.062-.082.093-.024.02-.024.02-.02.051h-.031c-.04.043-.074.094-.11.14-.007.013-.015.02-.023.032a3.26 3.26 0 00-.289.438c-.004.007-.012.02-.016.03a3.36 3.36 0 00-.28.63.934.934 0 01-.079.168c-.016.031-.016.031-.031.078-.028.016-.028.016-.063.031l-.027.016c-.094.039-.191.035-.29.035h-.944c-.196 0-.395 0-.59.004H4.355c-.117 0-.238 0-.359.004h-.394c-.364-.004-.364-.004-.72.074l-.03.012c-.024.007-.047.02-.07.027v.031c-.016.004-.016.004-.036.004-.05.012-.086.035-.129.063l-.047.03-.101.075v.031c-.016.008-.016.008-.028.012a.228.228 0 00-.082.066v.032c-.015.004-.03.011-.046.015-.028.036-.051.07-.075.106l-.023.031c-.149.238-.203.5-.2.777V11.312h1.97l.007-1.148V10v-.11-.163-.051a.74.74 0 01.207-.504.74.74 0 01.301-.156c.016-.004.031-.012.047-.016.035 0 .074-.004.11-.004h2.585c.051.004.098.012.149.02v.03c.023.024.023.024.054.048.067.054.09.101.114.187.046.156.113.297.187.442.02.039.035.082.05.12.095.188.216.368.337.54.012.015.012.015.023.035l.024.031c.008.012.015.02.02.031.007.004.01.012.019.02h.031l.012.027c.02.036.039.067.066.098h.031l.012.027a.629.629 0 00.129.16h.031v.032l.051.047.035.03c.059.048.113.095.172.142.04.03.04.03.066.058.055.055.118.094.176.133.016.012.028.02.043.027.035.028.074.051.114.078a.571.571 0 00.05.036c.094.058.192.109.29.16.05.023.05.023.09.047.038.023.077.039.12.054.055.02.106.04.16.063.07.035.149.054.223.078.043.012.082.027.121.039.133.043.262.074.399.086.011.004.02.012.03.015.36.07 1.02.153 1.36-.015.02 0 .04-.004.059-.004a1.54 1.54 0 00.3-.074l.165-.047a1.02 1.02 0 00.258-.094c.035-.015.066-.031.101-.043.172-.066.336-.156.492-.258l.102-.058a1.445 1.445 0 00.199-.133c.027-.016.05-.035.074-.055v-.031c.012-.004.024-.008.031-.012a.584.584 0 00.149-.11l.05-.05c.012-.008.02-.015.028-.023a.781.781 0 01.086-.075c.047-.043.09-.09.133-.14.023-.027.023-.027.05-.05.024-.024.024-.024.02-.056h.031c.028-.03.028-.03.055-.066.012-.012.02-.027.031-.04.028-.034.028-.034.04-.081h.03c.024-.031.024-.031.047-.074.04-.059.075-.118.114-.18.164-.25.297-.512.402-.793.016-.035.027-.074.043-.11.004-.015.012-.03.02-.05.004-.012.007-.027.015-.043l.016-.043c.02-.043.035-.05.078-.066l.031-.032c.09-.043.184-.035.278-.035h.058c.051 0 .102 0 .153-.004H16.23c.18 0 .36-.004.54-.004H17.247c.034 0 .034 0 .066-.02v-.757-.352-.304-.164-.18c0-.02 0-.035.003-.055-.003-.015-.003-.031-.003-.05v-.043c.003-.032.003-.032-.016-.047-.024 0-.047-.004-.074-.004h-.457c-.133-.004-.266-.004-.399-.004-.144 0-.289 0-.43-.004h-.382c-.258-.004-.258-.004-.352-.098-.066-.086-.094-.187-.125-.289-.027-.09-.07-.172-.11-.258-.015-.035-.03-.074-.046-.109-.008-.02-.016-.043-.027-.063-.004-.015-.012-.03-.02-.046h-.031l-.012-.043c-.02-.051-.043-.094-.07-.145l-.032-.047c-.007-.015-.02-.031-.027-.047l-.062-.109h-.032a.543.543 0 01-.046-.11h-.032c-.004-.007-.008-.019-.011-.027a1.02 1.02 0 00-.075-.105l-.086-.117h-.03l-.013-.028c-.023-.039-.05-.066-.082-.101-.062-.055-.062-.055-.078-.09h-.031V5.14c-.027-.028-.027-.028-.059-.055A.36.36 0 0013.937 5v-.031c-.03-.028-.066-.055-.097-.082-.016-.008-.016-.008-.031-.02-.047-.043-.047-.043-.106-.054V4.78c-.031-.023-.031-.023-.074-.05-.063-.04-.125-.079-.188-.122a2.455 2.455 0 00-.261-.144c-.051-.024-.098-.05-.145-.078a1.826 1.826 0 00-.254-.106l-.066-.023-.031-.012-.082-.035c-.094-.035-.192-.055-.29-.078a.625.625 0 00-.082-.02 1.778 1.778 0 00-.32-.058c-.05-.008-.05-.008-.098-.024-.03 0-.058-.004-.09-.004h-.703c-.093 0-.18.004-.273.028zm7.348 2.398v.031h-.032a.364.364 0 00-.054.211V7.79c.004.152 0 .305 0 .457V9.32a.488.488 0 00.055.196h.03c.005.007.009.02.012.027.028.05.063.074.114.098.066.007.133.007.199.007h.059c.05.004.101.004.152 0 .055 0 .105.004.156.004h.176c.105 0 .168-.011.25-.082a.452.452 0 00.121-.34v-.035-.11-.077-.211-.18-.422-.433-.371c0-.075 0-.149.004-.223v-.211c-.004-.023 0-.05 0-.074a.97.97 0 00-.055-.383h-.031v-.047c-.121-.101-.23-.113-.387-.113h-.398c-.016-.004-.027-.004-.043-.004-.129.004-.235.027-.328.117zm-16.75 5.578v.61H4.64v-.625H1.633a.71.71 0 00-.13 0c-.015-.004-.026-.004-.038-.004-.063 0-.063 0-.121.02zm1.597 1.477c-.011.012-.02.02-.027.031-.05.055-.05.055-.086.07v.032c-.015.004-.031.011-.047.015v.031a.19.19 0 01-.027.012c-.047.028-.082.063-.121.102l-.024.023c-.015.016-.03.031-.05.047-.024.027-.051.05-.075.078l-.046.047-.024.024c-.043.039-.043.039-.055.09l-.046.015v.031H2.28l-.047.051c-.058.07-.117.133-.175.2-.032.027-.032.027-.028.062H2v.031h-.031c-.024.027-.024.027-.051.063-.035.046-.074.093-.113.14-.043.04-.043.04-.04.078h-.03l-.016.063h-.032c-.023.027-.042.054-.062.082a.571.571 0 00-.035.05c-.031.036-.031.036-.028.07h-.03a1.83 1.83 0 00-.079.106l-.023.032c-.043.058-.043.058-.055.129h-.031c-.02.027-.02.027-.04.062-.011.02-.011.02-.027.043a.426.426 0 00-.023.043c-.047.078-.094.16-.145.234-.046.07-.082.14-.117.215-.008.012-.012.027-.02.04l-.034.077c-.012.032-.028.063-.043.094-.051.102-.086.2-.118.309-.011.039-.011.039-.027.054l-.023.114c-.004.015-.004.015-.004.03L.71 16.7c-.008.031-.012.063-.02.094a1.334 1.334 0 000 .43 1.78 1.78 0 00.094.457 2.259 2.259 0 00.324.664c.012.015.02.031.032.047a.784.784 0 00.125.156h.03l.013.023a.411.411 0 00.113.133h.031v.031c.145.137.332.258.512.344l.07.035c.11.059.223.09.34.121.012.004.023.008.04.012.108.031.218.05.331.063a1.828 1.828 0 00.441.004c.024-.004.043-.004.067-.008.129-.012.25-.032.371-.07l.05-.016c.087-.024.169-.051.247-.094.027-.012.055-.027.082-.04.258-.108.469-.284.668-.476.008-.007.02-.015.027-.027.024-.02.024-.02.02-.05h.031c.04-.044.04-.044.047-.095h.031c.078-.093.14-.195.2-.304.015-.031.035-.063.054-.094.031-.059.05-.121.074-.184.012-.035.028-.066.043-.101a.975.975 0 00.043-.152.68.68 0 01.02-.086c.082-.325.078-.68-.012-1-.004-.02-.008-.04-.016-.055a1.126 1.126 0 00-.093-.258 3.554 3.554 0 00-.375-.707c-.012-.023-.028-.047-.043-.07-.075-.121-.157-.23-.239-.344l-.136-.2-.02-.023h-.031l-.047-.093h-.031c-.008-.012-.008-.012-.012-.028a715.215 715.215 0 01-.09-.137l-.023-.023h-.032l-.011-.027c-.024-.047-.055-.082-.09-.125-.012-.016-.023-.031-.04-.047a.253.253 0 00-.03-.035h-.032l-.011-.028a.342.342 0 00-.075-.093c-.054-.047-.054-.047-.07-.082h-.031l-.012-.024c-.027-.055-.07-.094-.11-.133l-.027-.027-.058-.059-.086-.085-.055-.055-.023-.028c-.043-.043-.043-.043-.098-.058v-.031c-.027-.028-.027-.028-.058-.055-.067-.055-.067-.055-.09-.082-.04-.035-.075-.027-.114.004zm0 0"
      />
      <path
        fill={color}
        d="M11.938 4.703c.019 0 .039.004.062.008.117.012.23.047.34.09.043.015.086.027.129.039.12.035.23.09.344.144.011.004.019.012.03.016.137.07.266.145.391.234.02.016.04.028.059.043.023.012.043.028.062.043a.751.751 0 01.098.07v.032l.027.012c.047.027.086.062.125.097l.024.024c.215.199.215.199.293.304v.032h.031c.02.023.02.023.04.05.007.012.015.024.027.036l.023.039a.215.215 0 00.027.035c.059.086.114.172.164.261.008.016.02.032.028.047.093.153.164.313.222.485l.024.062a2.11 2.11 0 01.113.39c.055.243.07.481.07.727v.032c0 .191 0 .191-.02.258-.003.03-.003.066-.003.097a1.458 1.458 0 01-.05.285c-.02.063-.032.13-.04.196-.008.035-.008.035-.02.062l-.011.035c-.004.016-.012.028-.016.043l-.015.051c-.086.242-.2.477-.329.7h-.03c0 .007-.005.019-.005.027-.011.039-.03.066-.054.101-.016.016-.016.016-.028.035-.008.012-.02.024-.027.04-.012.011-.02.023-.027.035-.028.035-.051.07-.079.105l-.035.047c-.007.012-.02.02-.027.031h-.031c-.004.016-.012.031-.016.047h-.031l-.012.027c-.027.047-.066.086-.105.125l-.024.024c-.058.058-.058.058-.094.058v.032c-.03.03-.03.03-.078.062-.011.012-.027.024-.039.035-.039.028-.039.028-.07.028v.03h-.047v.032c-.105.09-.223.156-.344.219-.02.012-.043.023-.062.035-.11.059-.219.117-.336.156a.972.972 0 00-.113.043.694.694 0 01-.215.07.52.52 0 00-.133.04c-.11.03-.219.046-.328.062l-.047.008c-.07.008-.14.012-.21.012h-.27a2.516 2.516 0 01-.817-.114c-.035-.007-.07-.02-.105-.027-.383-.11-.758-.3-1.063-.555a6.705 6.705 0 00-.098-.074.326.326 0 01-.046-.031v-.031c-.012-.008-.012-.008-.028-.012a.293.293 0 01-.093-.074l-.036-.035-.035-.036-.035-.035c-.21-.21-.21-.21-.21-.277h-.032c-.024-.031-.047-.059-.067-.094l-.02-.027a5.57 5.57 0 01-.124-.2 2.413 2.413 0 01-.277-.574 1.664 1.664 0 00-.036-.105 2.499 2.499 0 01-.117-.438c-.004-.011-.004-.023-.008-.035a2.115 2.115 0 01-.035-.383v-.035a3.69 3.69 0 01.121-1.094l.012-.046a1.43 1.43 0 01.082-.215c.016-.035.031-.074.047-.114.031-.082.07-.167.11-.25h.03c0-.011.005-.019.005-.03a.56.56 0 01.082-.169.884.884 0 01.07-.113h.031c0-.008.004-.02.004-.027A.271.271 0 018.637 6l.023-.031c.008-.012.016-.024.027-.035l.024-.036a.215.215 0 00.027-.035c.008-.008.016-.02.024-.027.004-.008.011-.016.02-.024h.03l.016-.046h.031c.008-.016.008-.016.012-.028a.36.36 0 01.066-.086c.008-.007.016-.02.028-.027l.027-.027.028-.028c.007-.011.02-.02.027-.027l.023-.023c.024-.02.024-.02.055-.02v-.031c.02-.02.02-.02.05-.043l.032-.024c.012-.007.023-.02.035-.027.012-.008.024-.02.04-.027a2.88 2.88 0 01.53-.332c.036-.02.075-.036.11-.055.101-.05.207-.094.312-.133.016-.004.028-.012.043-.016a.893.893 0 01.145-.046l.039-.012c.187-.055.375-.074.57-.094l.094-.012c.23-.03.602-.05.813.055zm-1.188.703c-.023.004-.05.012-.078.016a.892.892 0 00-.172.058c-.035.016-.07.028-.105.043-.18.063-.336.145-.497.247-.035.023-.074.046-.113.07-.015.012-.031.023-.05.035v.031l-.028.012c-.035.02-.066.043-.102.066-.015.012-.015.012-.035.024l-.023.023v.032c-.016.003-.031.011-.047.015v.031l-.031.012c-.035.02-.035.02-.047.066H9.39c-.207.215-.395.5-.5.782a1.57 1.57 0 00-.125.371c-.032.125-.032.125-.047.176-.07.39-.055.808.062 1.187.004.024.012.047.016.07.015.059.039.11.062.165l.012.039c.027.07.059.136.09.203a.122.122 0 00.02.039c.042.097.042.097.097.187h.031c0 .008.004.016.004.024a.446.446 0 00.082.144.07.07 0 00.02.028.792.792 0 00.05.07h.032l.012.027c.02.035.039.063.066.094.012.016.012.016.023.027.024.028.024.028.055.024l.012.027c.023.043.05.07.09.102a.352.352 0 00.039.035c.027.027.027.027.062.023v.031c.024.02.024.02.055.04.012.007.02.015.031.023.012.008.024.016.04.023a.122.122 0 00.034.028c.055.043.055.043.121.058v.032l.04.02c.148.073.148.073.203.105a.925.925 0 00.183.078c.035.011.067.027.098.039a.9.9 0 00.168.047c.027.008.027.008.043.023l.129.024c.011 0 .023.003.039.003.023.004.05.008.078.016a2.385 2.385 0 001.113-.059l.055-.015a1.02 1.02 0 00.258-.094c.035-.015.066-.031.101-.043.086-.035.164-.078.242-.125a.426.426 0 01.043-.023c.082-.055.165-.11.239-.172a1.556 1.556 0 01.14-.106v-.03c.016-.005.032-.013.047-.017v-.03h.031v-.032c.016-.004.032-.012.047-.016v-.03h.032v-.032h.03c.048-.047.048-.047.063-.11h.032c.039-.042.039-.042.046-.093h.032c.035-.051.035-.051.047-.11h.03c.38-.66.563-1.398.364-2.152a1.89 1.89 0 00-.098-.285 1.817 1.817 0 01-.078-.203h-.03c0-.012-.005-.024-.005-.035a.323.323 0 00-.054-.118l-.024-.043a.263.263 0 00-.027-.043l-.024-.046c-.015-.02-.015-.02-.027-.04-.008-.011-.016-.027-.023-.039a.119.119 0 00-.02-.027h-.031c-.004-.016-.004-.016-.012-.035a.532.532 0 00-.082-.125c-.012-.016-.023-.027-.031-.043l-.031-.031h-.032c-.004-.016-.011-.032-.015-.047h-.032V6.14h-.03c-.005-.016-.013-.032-.017-.047h-.03v-.032h-.032v-.03a2.314 2.314 0 00-.102-.083c-.007-.008-.02-.015-.027-.023-.336-.258-.707-.45-1.125-.524-.031-.007-.062-.011-.09-.02a.995.995 0 00-.261-.027h-.266a1.972 1.972 0 00-.504.051zm0 0"
      />
      <path
        fill={color}
        d="M11.531 6.04a.419.419 0 01.156.21.845.845 0 010 .14l.024.008c.11.028.187.082.273.149l.047.035c.125.113.242.262.25.434-.011.054-.011.054-.031.109-.004.02-.012.035-.016.055a.434.434 0 01-.171.164.442.442 0 01-.301-.008.671.671 0 01-.2-.207.3.3 0 00-.214-.098.39.39 0 00-.27.125c-.039.059-.035.11-.039.176v.063a.3.3 0 00.094.175c.105.075.23.075.351.082.2.02.422.125.563.27v.031h.031c.18.211.297.465.285.75-.023.262-.12.524-.324.707a.98.98 0 01-.297.188c-.047.035-.047.047-.058.101-.004.016-.004.031-.008.043a.313.313 0 01-.035.117h-.032l-.011.028a.253.253 0 01-.141.12.411.411 0 01-.273-.015.369.369 0 01-.184-.215 5.085 5.085 0 00-.023-.109c-.004-.047-.004-.047-.04-.074-.015-.008-.03-.012-.046-.02a.852.852 0 01-.297-.215l-.035-.035c-.028-.027-.028-.027-.028-.058H10.5c-.078-.102-.09-.192-.086-.32a.31.31 0 01.133-.22.405.405 0 01.297-.07.481.481 0 01.23.172c.008.012.02.024.028.035.007.008.02.02.027.032.062.066.14.074.23.074.055-.008.106-.02.157-.031v-.032l.035-.035c.066-.066.078-.121.078-.21 0-.016 0-.016-.004-.032v-.035-.078h-.031c-.004-.02-.012-.043-.016-.063h-.031v-.031a.772.772 0 00-.207-.055c-.012-.004-.024-.004-.035-.008-.059-.007-.117-.02-.176-.023-.14-.012-.274-.094-.395-.164V8.14l-.027-.012c-.047-.024-.078-.059-.113-.098l-.035-.035c-.028-.027-.028-.027-.028-.059H10.5v-.046h-.031a.98.98 0 01-.149-.707c.024-.114.059-.22.102-.325h.031c.004-.011.004-.011.004-.027a.462.462 0 01.063-.113l.03-.043c.024-.031.044-.059.075-.082h.031v-.032c.028-.023.059-.042.086-.062.02-.012.035-.02.051-.031.129-.078.129-.078.176-.078 0-.012.004-.024.004-.036.015-.132.047-.214.148-.3a.352.352 0 01.41-.016zm0 0M3.188 14.703c.109.078.148.149.171.281v.079l.024.007c.14.04.254.121.351.227l.036.035c.027.027.027.027.027.059h.031c.078.12.113.214.094.359-.012.04-.027.07-.047.11h-.031l-.016.046h-.031v.031a.34.34 0 01-.25.075.381.381 0 01-.27-.164.393.393 0 00-.246-.153.386.386 0 00-.234.07.29.29 0 00-.094.188.382.382 0 00.063.25c.027.031.027.031.062.047v.031a.977.977 0 00.188.028c.027 0 .054.003.082.003.246.024.5.141.66.329.215.265.285.52.254.859a.99.99 0 01-.184.438h-.031l-.012.035a.194.194 0 01-.066.09h-.031v.03c-.055.048-.055.048-.094.048v.03c-.031.017-.063.032-.094.048a.695.695 0 00-.05.027c-.044.02-.044.02-.075.02-.004.015-.004.03-.008.047a1011.471 1011.471 0 00-.023.117.415.415 0 01-.063.133H3.25v.03c-.023.02-.023.02-.059.04l-.03.023a.347.347 0 01-.259.02.442.442 0 01-.215-.16 1.196 1.196 0 01-.058-.211c-.024-.047-.047-.055-.094-.07a1.076 1.076 0 01-.27-.188v-.031c-.015-.004-.03-.012-.046-.016-.031-.04-.031-.04-.063-.09-.02-.023-.02-.023-.035-.05a.394.394 0 01-.043-.25c.016-.055.04-.106.063-.157h.03c.005-.015.013-.031.017-.047.085-.074.183-.09.296-.086a.37.37 0 01.22.133v.031h.03c.024.028.047.055.067.082a.182.182 0 00.14.063c.145.004.145.004.262-.067h.031a.139.139 0 01.016-.035c.016-.043.016-.043.031-.07a.43.43 0 00.016-.223.303.303 0 00-.063-.093v-.032l-.078-.03v-.032c-.02 0-.035-.004-.054-.008-.012 0-.024 0-.04-.004a1.03 1.03 0 00-.109-.008c-.215-.023-.215-.023-.312-.074-.036-.02-.036-.02-.09-.031-.219-.082-.395-.297-.489-.5A1.042 1.042 0 011.98 16v-.043c0-.207.086-.414.208-.582h.03a.056.056 0 00.009-.023.478.478 0 01.117-.133h.031v-.031l.105-.063.032-.02c.078-.043.078-.043.129-.043v-.03a.392.392 0 01.109-.282c.137-.125.277-.137.438-.047zm0 0"
      />
    </g>
  </svg>
);

const Menu: React.FC<React.PropsWithChildren<NavProps>> = ({
  linkComponent = "a",
  banner,
  rightSide,
  isDark,
  toggleTheme,
  currentLang,
  setLang,
  cakePriceUsd,
  links,
  subLinks,
  footerLinks,
  activeItem,
  activeSubItem,
  langs,
  buyCakeLabel,
  buyCakeLink,
  children,
  chainId,
}) => {
  const { isMobile } = useMatchBreakpoints();
  const isMounted = useIsMounted();
  const [showMenu, setShowMenu] = useState(true);
  const refPrevOffset = useRef(typeof window === "undefined" ? 0 : window.pageYOffset);

  const [mobileNavOpen, setMobileNavOpen] = useState(false);

  const topBannerHeight = isMobile ? TOP_BANNER_HEIGHT_MOBILE : TOP_BANNER_HEIGHT;

  const totalTopMenuHeight = isMounted && banner ? MENU_HEIGHT + topBannerHeight : MENU_HEIGHT;

  const [activeLink, setActiveLink] = useState("");

  useEffect(() => {
    setActiveLink(window?.location?.pathname);
  }, [window?.location?.pathname]);

  useEffect(() => {
    const handleScroll = () => {
      const currentOffset = window.pageYOffset;
      const isBottomOfPage = window.document.body.clientHeight === currentOffset + window.innerHeight;
      const isTopOfPage = currentOffset === 0;
      // Always show the menu when user reach the top
      if (isTopOfPage) {
        setShowMenu(true);
      }
      // Avoid triggering anything at the bottom because of layout shift
      else if (!isBottomOfPage) {
        if (currentOffset < refPrevOffset.current || currentOffset <= totalTopMenuHeight) {
          // Has scroll up
          setShowMenu(true);
        } else {
          // Has scroll down
          setShowMenu(false);
        }
      }
      refPrevOffset.current = currentOffset;
    };
    const throttledHandleScroll = throttle(handleScroll, 200);

    window.addEventListener("scroll", throttledHandleScroll);
    return () => {
      window.removeEventListener("scroll", throttledHandleScroll);
    };
  }, [totalTopMenuHeight]);

  // Find the home link if provided
  const homeLink = links.find((link) => link.label === "Home");

  const subLinksWithoutMobile = useMemo(() => subLinks?.filter((subLink) => !subLink.isMobileOnly), [subLinks]);
  const subLinksMobileOnly = useMemo(() => subLinks?.filter((subLink) => subLink.isMobileOnly), [subLinks]);
  const providerValue = useMemo(() => ({ linkComponent }), [linkComponent]);

  const topLevelLinks: any = [];
  const nestedLinks: any = [];

  const newLinks = [
    {
      label: "Swap",
      href: "/swap",
      icon: <SwapIcon />,
    },
    {
      label: "Liquidity",
      href: "/liquidity",
      icon: <LiquidityIcon />,
    },
  ];

  return (
    <MenuContext.Provider value={providerValue}>
      <AtomBox
        asChild
        minHeight={{
          xs: "auto",
          md: "100vh",
        }}
      >
        <Wrapper>
          <CustomHeaderWrapperStyled>
            <StyledSidebar mobileNavOpen={mobileNavOpen}>
              {/* Default header here (code below) */}
              <MainLinkContainerStyled>
                {newLinks.map(
                  (item) =>
                    item.href && (
                      <MainLinkStyled
                        key={`${item.href}${item.label}`}
                        className={activeLink === item.href ? "active" : ""}
                      >
                        <b className="top-curve" />
                        {/* eslint-disable jsx-a11y/no-static-element-interactions */}
                        {/* eslint-disable-next-line jsx-a11y/click-events-have-key-events */}
                        <span onClick={() => setMobileNavOpen(false)}>
                          <MenuItem {...{ href: item.href }} isActive={activeLink === item.href}>
                            <StyledIcon>{item.icon}</StyledIcon> <span>{item.label}</span>
                          </MenuItem>
                        </span>
                        <b className="bottom-curve" />
                      </MainLinkStyled>
                    )
                )}
              </MainLinkContainerStyled>
            </StyledSidebar>
            <BodyWrapper mt={!subLinks ? `${totalTopMenuHeight + 1}px` : "0"}>
              {/* eslint-disable jsx-a11y/no-static-element-interactions */}
              {mobileNavOpen && <BackDrop onClick={() => setMobileNavOpen(!mobileNavOpen)} />}
              <Inner>{children}</Inner>
            </BodyWrapper>
          </CustomHeaderWrapperStyled>
        </Wrapper>
      </AtomBox>
      {/* eslint-disable jsx-a11y/no-static-element-interactions */}
      <MobileNav onClick={() => setMobileNavOpen(!mobileNavOpen)} />
    </MenuContext.Provider>
  );
};

export default Menu;

// {links
//   .filter((i) => i.label === "Trade")
//   .map(({ label, href, items }) => (
//     <MainLinkStyled key={href} className={activeItem === href ? "active" : ""}>
//       <b className="top-curve" />
//       {items ? (
//         <DropdownMenu
//           items={items.filter((i) => i.label === "Swap" || i.label === "Liquidity")}
//           label={label}
//           active={activeItem === href}
//         />
//       ) : (
//         <MenuItem {...{ href }} isActive={activeItem === href}>
//           {label}
//         </MenuItem>
//       )}
//       <b className="bottom-curve" />
//     </MainLinkStyled>
//   ))}

// {links.map(({ label, items: menuItems = [], href, icon, disabled }) => {
//   const statusColor = menuItems?.find((menuItem) => menuItem.status !== undefined)?.status?.color;
//   const isActive = activeItem === href;
//   const linkProps = isTouchDevice() && menuItems && menuItems.length > 0 ? {} : { href };
//   const Icon = icon;
//   return (
//     <DropdownMenu
//       key={`${label}#${href}`}
//       items={menuItems}
//       py={1}
//       activeItem={activeSubItem}
//       isDisabled={disabled}
//     >
//       <MenuItem {...linkProps} isActive={isActive} statusColor={statusColor} isDisabled={disabled}>
//         {label || (icon && createElement(Icon as any, { color: isActive ? "secondary" : "textSubtle" }))}
//       </MenuItem>
//     </DropdownMenu>
//   );
// })}

// <FixedContainer showMenu={showMenu} height={totalTopMenuHeight}>
//   {banner && isMounted && <TopBannerContainer height={topBannerHeight}>{banner}</TopBannerContainer>}
//   <StyledNav>
//     <Flex flexDirection="column">
//       <Logo href={homeLink?.href ?? "/"} />
//       <AtomBox display={{ xs: "none", md: "flex" }} flexDirection="column">
// <MenuItems
//           items={links}
//           activeItem={activeItem}
//           activeSubItem={activeSubItem}
//           ml="24px"
//           display="flex"
//           flexDirection="column"
//         />
//       </AtomBox>
//     </Flex>
//     <Flex flexDirection="column" alignItems="center" height="100%">
//       <AtomBox mr="12px" display={{ xs: "none", lg: "block" }}>
//         <CakePrice chainId={chainId} showSkeleton={false} cakePriceUsd={cakePriceUsd} />
//       </AtomBox>
//       <Box mt="4px">
//         <LangSelector
//           currentLang={currentLang}
//           langs={langs}
//           setLang={setLang}
//           buttonScale="xs"
//           color="textSubtle"
//           hideLanguage
//         />
//       </Box>
//       {rightSide}
//     </Flex>
//   </StyledNav>
// </FixedContainer>
// {subLinks ? (
//   <Flex justifyContent="space-around" overflow="hidden" flexDirection="column">
//     <SubMenuItems
//       items={subLinksWithoutMobile}
//       mt={`${totalTopMenuHeight + 1}px`}
//       activeItem={activeSubItem}
//     />

//     {subLinksMobileOnly && subLinksMobileOnly?.length > 0 && (
// <SubMenuItems
//   items={subLinksMobileOnly}
//   mt={`${totalTopMenuHeight + 1}px`}
//   activeItem={activeSubItem}
//   isMobileOnly
// />
//     )}
//   </Flex>
// ) : (
//   <div />
// )}
